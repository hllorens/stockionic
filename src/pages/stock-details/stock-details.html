<ion-header>
  <ion-navbar>
    <button menuToggle *ngIf="!stock">
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>{{ stock.name }}:{{stock.market}} </ion-title>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-grid>
  <ion-row>
      <ion-col width-100><h3  style="color:blue">{{ stock.title }}</h3></ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
      MktCap: {{stock.mktcap}} Shares: {{stock.shares}} Employees: {{stock.employees}}k<br />
    <span style="color:purple;">YPR: {{stock.avgyield_per_ratio}}</span> <br />
    calc: YPR_orig=({{stock.avgyield}}(max 7, min 0.75)/{{stock.per}}(min 6, max 100))
    per: last 4 quarters (note for es-es info is not always fresh use manual to freshen it quicker)
    calc: ypr_orig={{stock.avgyield_per_ratio_original}}
    new: + max(min((om(max 55)/8),0.2),7) / ps*4 (min 6, max 100) (depends on industry... review hightest ratios maybe consider changes, some have 0.5 which is ridiculous so a minimum of 1.5x4 6 is ok I think)
    all divided by {{stock.leverage}}/max(industry,2.5) (min 1, max 2)
    calc: om/ps om={{stock.operating_margin}}  ps={{stock.price_to_sales}}
    om (is last quarter, we prefer stable oms so if very bad quarter it will rank the company down)
    calc: leverage ttm: {{stock.leverage}} industry: {{stock.leverage_industry}} (min 2.5)
    <br /> - Volat: {{ stock.range_52week_volatility }}  -  Beta: {{stock.beta}}
    </ion-col>
  </ion-row>
  <ion-row>
      <ion-col width-50><h5>FACTS <span style="font-size:0.7em;">updated:{{stock.date}}</span></h5></ion-col>
      <ion-col width-50><h5><ion-icon name="notifications"></ion-icon> ALERT  </h5></ion-col>
  </ion-row>
  <ion-row>
    <ion-col width-15>
      <h4>Value</h4>
      <p><progress-bar [progress]="mult100(stock.range_52week_heat)"></progress-bar></p>
    </ion-col>
    <ion-col width-15>
      <h4 style="color:blue;">{{ stock.value }}</h4>
      <p><span style="text-align=right;font-size:0.8em;">{{ stock.range_52week_low }}-{{ stock.range_52week_high }}</span></p>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low">low</span><span style="color:red;" *ngIf="alert_status.low">low</span></ion-label> 
                <ion-input type="text" [value]="alert.low" [(ngModel)]="alert.low" (blur)="update_alert('low','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high">high</span><span style="color:red;" *ngIf="alert_status.high">high</span></ion-label>
                <ion-input type="text" [value]="alert.high" [(ngModel)]="alert.high" (blur)="update_alert('high','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  
  <ion-row *ngIf="usd_market(stock.market)">
    <ion-col width-15>
      <h4>ValEur: <span style="text-align=right;font-size:0.8em;">{{toFixed2(usdeur)}}</span></h4>
    </ion-col>
    <ion-col width-15>
      <h4 style="color:blue;">{{usd2eur(stock.value)}}</h4>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.lowe">low</span><span style="color:red;" *ngIf="alert_status.lowe">low</span></ion-label> 
                <ion-input type="text" [value]="alert.lowe" [(ngModel)]="alert.lowe" (blur)="update_alert('lowe','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.highe">high</span><span style="color:red;" *ngIf="alert_status.highe">high</span></ion-label>
                <ion-input type="text" [value]="alert.highe" [(ngModel)]="alert.highe" (blur)="update_alert('highe','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>

  
  <ion-row>
    <ion-col width-15>
      <h4>Portf</h4>
    </ion-col>
    <ion-col width-15>
      <h5 style="color:green;" *ngIf="(portfdiff()>=0)">{{mult100(portfdiff())}}%</h5>
      <h5 style="color:red;"   *ngIf="(portfdiff()<0)">{{mult100(portfdiff())}}%</h5>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.portf">valeur</span><span style="color:red;" *ngIf="alert_status.portf">valeur</span></ion-label> 
                <ion-input type="text" [value]="alert.portf" [(ngModel)]="alert.portf" (blur)="update_alert('portf','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25  *ngIf="alert.portf">
        stop (-20%val): <span>{{toFixed2(loss_percentage(stock.value))}}</span><br />
        stop (-20%portf): <span>{{toFixed2(loss_percentage_portf(alert.portf))}}</span> 
    </ion-col>
  </ion-row>

  <ion-row>
    <ion-col width-15>
      <h4>Change</h4>
    </ion-col>
    <ion-col width-15>
      <h5 style="color:black;">{{ stock.session_change_percentage }}%</h5>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_change_percentage">low</span><span style="color:red;" *ngIf="alert_status.low_change_percentage">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_change_percentage" [(ngModel)]="alert.low_change_percentage" (blur)="update_alert('low_change_percentage','-num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_change_percentage">high</span><span style="color:red;" *ngIf="alert_status.high_change_percentage">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_change_percentage" [(ngModel)]="alert.high_change_percentage" (blur)="update_alert('high_change_percentage','+num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  

  
  <ion-row>
    <ion-col width-15>
      <h4>Yield</h4>
    </ion-col>
    <ion-col width-15>
      <h4 style="color:black;"><ion-badge color="secondary">{{ stock.yield }}% <span style="font-size:0.7em;">({{ stock.divs_per_year }})</span></ion-badge></h4>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_yield">low</span><span style="color:red;" *ngIf="alert_status.low_yield">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_yield" [(ngModel)]="alert.low_yield" (blur)="update_alert('low_yield','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_yield">high</span><span style="color:red;" *ngIf="alert_status.high_yield">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_yield" [(ngModel)]="alert.high_yield" (blur)="update_alert('high_yield','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>  
  <ion-row>
    <ion-col width-15>
      <h4>PE Ratio</h4>
    </ion-col>
    <ion-col width-15>
      <h5 style="color:orange;">{{ stock.per }}</h5>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_per">low</span><span style="color:red;" *ngIf="alert_status.low_per">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_per" [(ngModel)]="alert.low_per" (blur)="update_alert('low_per','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_per">high</span><span style="color:red;" *ngIf="alert_status.high_per">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_per" [(ngModel)]="alert.high_per" (blur)="update_alert('high_per','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col width-15>
      <h4>EPS(av)</h4>
      <p>price-ind 4q</p>
    </ion-col>
    <ion-col width-15>
      <h5>{{stock.eps}}</h5>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_eps">low</span><span style="color:red;" *ngIf="alert_status.low_eps">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_eps" [(ngModel)]="alert.low_eps" (blur)="update_alert('low_eps','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_eps">high</span><span style="color:red;" *ngIf="alert_status.high_eps">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_eps" [(ngModel)]="alert.high_eps" (blur)="update_alert('high_eps','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
       <b>EPS hist (annual avg 4Q):</b> 
       <ul class="list">
            <li class="item" *ngFor="let eps_item of stock.eps_hist" >
             {{eps_item[0]}}: <b>{{eps_item[1]}}</b>
            </li>
        </ul>
        <div *ngIf="stock.eps_hist.length>1 && stock.eps_hist_last_diff && stock.eps_hist_last_diff!=0">Last eps diff: <br />
            {{stock.eps_hist[stock.eps_hist.length-1][1]}}-{{stock.eps_hist[stock.eps_hist.length-2][1]}}=
            <span style="color:red;" *ngIf="stock.eps_hist.length>1 && stock.eps_hist_last_diff<0">{{stock.eps_hist_last_diff}}% {{stock.eps_hist_trend}}</span>
            <span style="color:green;" *ngIf="stock.eps_hist.length>1 && stock.eps_hist_last_diff>0">{{stock.eps_hist_last_diff}}% {{stock.eps_hist_trend}}</span>
        </div>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
       <b>Yield avg: <span style="color:green;">{{stock.avgyield}}</span></b>
       <b>Yield hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let yield_item of stock.yield_hist" >
             {{yield_item[0]}}: <b>{{yield_item[1]}}</b>
            </li>
        </ul>
       <br /> alternative: dividend.com, DivY/Price History graph, disable Price in legend
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
       <b>PER avg: <span style="color:orange;">{{stock.avgper}}</span></b>
       <b>PER hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let per_item of stock.per_hist" >
             {{per_item[0]}}: <b>{{per_item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>

  <ion-row>
    <ion-col>
       <b>revenue (yearly, remove the quarterly storage...) <span style="color:orange;">{{stock.revenue}}</span></b>
       <b>revenue hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let revenue_item of stock.revenue_hist" >
             {{revenue_item[0]}}: <b>{{revenue_item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>
  
  
  <ion-row>
    <ion-col>
       <b>leverage  <span style="color:brown;">{{stock.leverage}}</span> industry: {{stock.leverage_industry}} <!--avg: <span style="color:pink;">{{stock.avgleverage}}</span>--></b>
       <b>leverage hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let lev_item of stock.leverage_hist" >
             {{lev_item[0]}}: <b>{{lev_item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>

  <ion-row>
    <ion-col>
       <b>price to book <span style="color:brown;">{{stock.price_to_book}}</span></b>
       <b>price_to_book hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let price_to_book_item of stock.price_to_book_hist" >
             {{price_to_book_item[0]}}: <b>{{price_to_book_item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>
  
  
  
  

  </ion-grid>
  


</ion-content>
