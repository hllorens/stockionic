<ion-header>
  <ion-navbar>
    <button menuToggle *ngIf="!stock">
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>{{ stock.name }}:{{stock.market}} </ion-title>
  </ion-navbar>
</ion-header>

<ion-content>
  <ion-grid>
  <ion-row>
      <ion-col width-100><h3  style="color:blue">{{ stock.title }} 
        <span *ngIf="stock.last_financials_outdated" style="color:red;">({{stock.last_financials_year}})</span>
        <span *ngIf="!stock.last_financials_outdated">({{stock.last_financials_year}})</span>
      </h3></ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
     <span style="font-size:0.8em;">Updated: {{stock.date}}</span><br />
      MktCap: <b>{{stock.mktcap}}B</b> <span [hidden]="stock.mktcap<10" style="font-size:0.8em;color:red;">big</span><span [hidden]="stock.mktcap>2" style="font-size:0.8em;color:purple;">small</span> Shares: {{stock.shares}} Employees: {{stock.employees}}k Inst: {{stock.inst_own}}<br />
    <ion-grid>
    <ion-row class="border">
        <ion-col>
        </ion-col>
        <ion-col>
        Exam: <b>{{stock.calc_type.name}}</b> 
        </ion-col>
        <ion-col>
         <span *ngIf="stock.h_souce>=5" style="font-weight:bold;color:purple">{{stock.h_souce}}</span><span *ngIf="stock.h_souce<5" style="font-weight:bold;color:red">{{stock.h_souce}}</span> / {{10}}
        </ion-col>
    </ion-row>
    <!--<ion-row class="border">
      <ion-col>Yield</ion-col>
      <ion-col>
      y:<span style="color:green">{{mult100_fix2(stock.calc_computable_yield)}}%</span> &nbsp; epsp: <span *ngIf="stock.epsp>0" style="color:orange">{{mult100_fix2(stock.epsp)}}%</span><span *ngIf="stock.epsp<=0" style="color:red">{{mult100_fix2(stock.epsp)}}%</span><br /><br />
      {{toFixed2(stock.calc_yield)}} * w({{stock.calc_type.weight_yield}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_yield_w)}} / {{stock.calc_type.weight_yield}}</ion-col>
    </ion-row>-->
    <ion-row class="border">
      <ion-col>Value G</ion-col>
      <ion-col>
      5y:{{stock.val_change_5y}} p:{{stock.val_change_5yp}}<br />
      3y:{{stock.val_change_3y}} p:{{stock.val_change_3yp}} pp:{{stock.val_change_3ypp}}<br />
      avg: <span *ngIf="stock.calc_computable_val_growth>0" style="color:green">{{mult100_fix2(toFixed2(stock.calc_computable_val_growth))}}%</span><span *ngIf="stock.calc_computable_val_growth<=0" style="color:red">{{mult100_fix2(toFixed2(stock.calc_computable_val_growth))}}%</span> y:<span style="color:green">{{mult100_fix2(toFixed2(stock.calc_computable_yield))}}%</span><br />
      avg+y: <span *ngIf="stock.calc_computable_val_growth_y>0" style="color:green">{{mult100_fix2(toFixed2(stock.calc_computable_val_growth_y))}}%</span><span *ngIf="stock.calc_computable_val_growth_y<=0" style="color:red">{{mult100_fix2(toFixed2(stock.calc_computable_val_growth_y))}}%</span>(max 20*5, 1p)<br />
      {{toFixed2(stock.calc_val_growth)}} * w({{stock.calc_type.weight_val_growth}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_val_growth_w)}} / {{stock.calc_type.weight_val_growth}}</ion-col>
    </ion-row>
    <ion-row class="border">
      <ion-col>Revenue G</ion-col>
      <ion-col>
      5y=<span *ngIf="stock.avg_revenue_growth_5y>0" style="color:green">{{stock.avg_revenue_growth_5y}}</span><span *ngIf="stock.avg_revenue_growth_5y<=0" style="color:red">{{stock.avg_revenue_growth_5y}}</span>%(max 0.20*5, 1p)<br />
      qq={{stock.revenue_growth_qq_last_year}} (max 0.1)<br />
      om/ps={{stock.operating_margin}}/{{stock.price_to_sales}}={{stock.calc_om_ps}} (max 0.3)<br />
      {{toFixed2(stock.calc_rev_growth)}} * w({{stock.calc_type.weight_rev_growth}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_rev_growth_w)}} / {{stock.calc_type.weight_rev_growth}}</ion-col>
    </ion-row>
    <ion-row class="border">
      <ion-col>Earnings</ion-col>
      <ion-col>
      epsp=<span *ngIf="stock.epsp>0" style="color:orange">{{mult100_fix2(stock.epsp)}}%</span><span *ngIf="stock.epsp<=0" style="color:red">{{mult100_fix2(stock.epsp)}}%</span>(max 1)<br />
      trend=<span style="color:red;" *ngIf="stock.eps_hist.length>1   && (stock.eps_hist_trend!='/' && stock.eps_hist_trend!='/-' && stock.eps_hist_trend!='_/' && stock.eps_hist_trend!='--' && stock.eps_hist_trend!='v')">{{stock.eps_hist_trend}}</span><span style="color:green;" *ngIf="stock.eps_hist.length>1 && (stock.eps_hist_trend=='/' || stock.eps_hist_trend=='/-' || stock.eps_hist_trend=='_/' || stock.eps_hist_trend=='--' || stock.eps_hist_trend=='v') ">{{stock.eps_hist_trend}}</span><br />
      {{toFixed2(stock.calc_epsp)}} * w({{stock.calc_type.weight_epsp}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_epsp_w)}} / {{stock.calc_type.weight_epsp}}</ion-col>
    </ion-row>
    <ion-row class="border">
      <ion-col>Leverage</ion-col>
      <ion-col>
      lev:{{stock.leverage}} ind:{{stock.leverage_industry}}(min 2.5) <br />
      ratio:<span *ngIf="stock.leverage_industry_ratio<=1.9" style="color:green">{{stock.leverage_industry_ratio}}</span><span *ngIf="stock.leverage_industry_ratio>1.9" style="color:red">{{stock.leverage_industry_ratio}}</span><br />
      {{toFixed2(stock.calc_leverage)}} * w({{stock.calc_type.weight_leverage}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_leverage_w)}} / {{stock.calc_type.weight_leverage}}</ion-col>
    </ion-row>
    <ion-row class="border">
      <ion-col>Negative val growth</ion-col>
      <ion-col>
      yy_drops:{{stock.val_yy_drops}}%<br />
      {{toFixed2(stock.calc_val_growth_penalty)}} * w({{stock.calc_type.weight_val_growth_penalty}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_val_growth_penalty_w)}} / -{{stock.calc_type.weight_val_growth_penalty}}</ion-col>
    </ion-row>
    <ion-row class="border">
      <ion-col>Negative rev growth</ion-col>
      <ion-col>
      {{toFixed2(stock.calc_rev_growth_penalty)}} * w({{stock.calc_type.weight_rev_growth_penalty}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_rev_growth_penalty_w)}} / -{{stock.calc_type.weight_rev_growth_penalty}}</ion-col>
    </ion-row>
    <ion-row class="border">
      <ion-col>Negative eps growth</ion-col>
      <ion-col>
      {{toFixed2(stock.calc_eps_growth_penalty)}} * w({{stock.calc_type.weight_eps_growth_penalty}})</ion-col>
      <ion-col>{{toFixed2(stock.calc_eps_growth_penalty_w)}} / -{{stock.calc_type.weight_eps_growth_penalty}}</ion-col>
    </ion-row>
    </ion-grid>
      
    <b>Share Price VALUATION</b>:<br /> 
    <ion-grid>
        <ion-row>
            <ion-col>Market: <b>{{ stock.value }}</b></ion-col>
            <ion-col>Guess: <b>{{stock.calc_value}}</b></ion-col>
        </ion-row>
        <ion-row>
            <ion-col>Sales times operating*3: {{stock.calc_value_sell_share}} (raw:{{stock.calc_value_sell_share_raw}})</ion-col>
            <ion-col>(Growth+(Earnings*4))/7: {{stock.calc_value_mult_factor}}</ion-col>
        </ion-row>
        <ion-row>
            <ion-col>Assets-Liabilities (Equity):    {{stock.calc_value_asset_share}}</ion-col>
            <ion-col>~ PB: {{stock.price_to_book}}</ion-col>
        </ion-row>
        <ion-row>
            <ion-col>Guess=({{stock.calc_value_sell_share}}*{{stock.calc_value_mult_factor}})+{{stock.calc_value_asset_share}}={{stock.calc_value}}</ion-col>
        </ion-row>
    </ion-grid>
      

    </ion-col>
  </ion-row>
  <ion-row>
      <ion-col width-50><h5>FACTS</h5></ion-col>
      <ion-col width-50><h5><ion-icon name="notifications"></ion-icon> ALERT  </h5></ion-col>
  </ion-row>
  <ion-row>
    <ion-col width-15>
      <h4>Value</h4>
      <p><progress-bar [progress]="mult100(stock.range_52week_heat)"></progress-bar></p>
    </ion-col>
    <ion-col width-15>
      <h4 style="color:blue;">{{ stock.value }} </h4>
      <p><span style="text-align=right;font-size:0.8em;">{{ stock.range_52week_low }}-{{ stock.range_52week_high }}</span></p>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low">low</span><span style="color:red;" *ngIf="alert_status.low">low</span></ion-label> 
                <ion-input type="text" [value]="alert.low" [(ngModel)]="alert.low" (blur)="update_alert('low','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high">high</span><span style="color:red;" *ngIf="alert_status.high">high</span></ion-label>
                <ion-input type="text" [value]="alert.high" [(ngModel)]="alert.high" (blur)="update_alert('high','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  
  <ion-row *ngIf="usd_market(stock.market)">
    <ion-col width-15>
      <h4>ValEur: <span style="text-align=right;font-size:0.8em;">{{toFixed2(usdeur)}}</span></h4>
    </ion-col>
    <ion-col width-15>
      <h4 style="color:blue;">{{usd2eur(stock.value)}}</h4>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.lowe">low</span><span style="color:red;" *ngIf="alert_status.lowe">low</span></ion-label> 
                <ion-input type="text" [value]="alert.lowe" [(ngModel)]="alert.lowe" (blur)="update_alert('lowe','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.highe">high</span><span style="color:red;" *ngIf="alert_status.highe">high</span></ion-label>
                <ion-input type="text" [value]="alert.highe" [(ngModel)]="alert.highe" (blur)="update_alert('highe','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>

  
  <ion-row>
    <ion-col width-15>
      <h4>Portf</h4>
    </ion-col>
    <ion-col width-15>
      <h5 style="color:green;" *ngIf="(portfdiff()>=0)">{{mult100(portfdiff())}}%</h5>
      <h5 style="color:red;"   *ngIf="(portfdiff()<0)">{{mult100(portfdiff())}}%</h5>
    </ion-col>
    <ion-col width-15>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.portf">valeur</span><span style="color:red;" *ngIf="alert_status.portf">valeur</span></ion-label> 
                <ion-input type="text" [value]="alert.portf" [(ngModel)]="alert.portf" (blur)="update_alert('portf','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25  *ngIf="alert.portf">
        <span *ngIf="show_stop_val()">stop-20%val: <b><span *ngIf="usd_market(stock.market)">$</span>{{toFixed2(loss_percentage(stock.value))}}</b><br />w: <b>{{stopdiff()}}%</b></span>
        <span *ngIf="!show_stop_val()">stop-20%port: <b><span *ngIf="usd_market(stock.market)">$</span>{{toFixed2(loss_percentage_portf(alert.portf))}}</b><br />w: <b>{{stopdiff()}}%</b></span> 
    </ion-col>
  </ion-row>

  <ion-row>
    <ion-col width-15>
      <h4>Change</h4>
    </ion-col>
    <ion-col width-15>
      <h5 style="color:black;">{{ stock.session_change_percentage }}%</h5>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_change_percentage">low</span><span style="color:red;" *ngIf="alert_status.low_change_percentage">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_change_percentage" [(ngModel)]="alert.low_change_percentage" (blur)="update_alert('low_change_percentage','-num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_change_percentage">high</span><span style="color:red;" *ngIf="alert_status.high_change_percentage">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_change_percentage" [(ngModel)]="alert.high_change_percentage" (blur)="update_alert('high_change_percentage','+num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  

  
  <ion-row>
    <ion-col width-15>
      <h4>Yield</h4>
    </ion-col>
    <ion-col width-15>
      <h4 style="color:black;"><ion-badge color="secondary">{{ stock.yield }}% <span style="font-size:0.7em;">({{ stock.divs_per_year }})</span></ion-badge></h4>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_yield">low</span><span style="color:red;" *ngIf="alert_status.low_yield">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_yield" [(ngModel)]="alert.low_yield" (blur)="update_alert('low_yield','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_yield">high</span><span style="color:red;" *ngIf="alert_status.high_yield">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_yield" [(ngModel)]="alert.high_yield" (blur)="update_alert('high_yield','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>  
  <ion-row>
    <ion-col width-15>
      <h4>EPS(av)</h4>
      <p>price-ind 4q</p>
    </ion-col>
    <ion-col width-15>
      <h5>{{stock.eps}}</h5>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.low_eps">low</span><span style="color:red;" *ngIf="alert_status.low_eps">low</span></ion-label>
                <ion-input type="text" [value]="alert.low_eps" [(ngModel)]="alert.low_eps" (blur)="update_alert('low_eps','num')"></ion-input>
            </ion-item>
    </ion-col>
    <ion-col width-25>
            <ion-item>
                <ion-label floating><span *ngIf="!alert_status.high_eps">high</span><span style="color:red;" *ngIf="alert_status.high_eps">high</span></ion-label>
                <ion-input type="text" [value]="alert.high_eps" [(ngModel)]="alert.high_eps" (blur)="update_alert('high_eps','num')"></ion-input>
            </ion-item>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
       <b>Yield avg: <span style="color:green;">{{stock.avgyield}}</span></b>
       <b>Yield last diff:       
       <span style="color:green;" *ngIf="(stock.yield_hist_last_diff>=0)">{{stock.yield_hist_last_diff}}%</span>
       <span style="color:red;"   *ngIf="(stock.yield_hist_last_diff<0)">{{stock.yield_hist_last_diff}}%</span>
        </b>. 
       <b>Yield hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let yield_item of stock.yield_hist" >
             {{yield_item[0]}}: <b>{{yield_item[1]}}</b>
            </li>
        </ul>
       <br /> alternative: dividend.com, DivY/Price History graph, disable Price in legend
    </ion-col>
  </ion-row>
  <!--<ion-row>
    <ion-col>
       <b>EPSP last diff: 
      <span style="color:red;" *ngIf="(stock.epsp_hist_last_diff>=0)">{{stock.epsp_hist_last_diff}}%</span>
      <span style="color:green;"   *ngIf="(stock.epsp_hist_last_diff<0)">{{stock.epsp_hist_last_diff}}%</span>
        </b>. 
       <b>EPSP hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let item of stock.epsp_hist" >
             {{item[0]}}: <b>{{item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>-->
  <ion-row>
    <ion-col>
       <b>val diff 54w: 
      <span class="{{stock.value_hist_last_diff > 10 ? 'green': ''}} {{stock.value_hist_last_diff < -10 ? 'red': '' }}">{{stock.value_hist_last_diff}}%</span>
        </b>. 
       <b>value hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let valhist of stock.value_hist; let i=index;" >
             {{valhist[0]}}: {{valhist[1]}} &nbsp; <span *ngIf="i>0" class="{{diff_percentage(stock.value_hist,i) > 10 ? 'green': ''}} {{diff_percentage(stock.value_hist,i) < -10 ? 'red': '' }}">{{diff_percentage(stock.value_hist,i)}}%</span>
            </li>
        </ul>
    </ion-col>
    <ion-col>
       <b>revenue hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let revenue_item of stock.revenue_hist; let i=index;" >
             {{revenue_item[0]}}: <b>{{revenue_item[1]}}</b>  &nbsp; <span *ngIf="i>0" class="{{diff_percentage(stock.revenue_hist,i) > 10 ? 'green': ''}} {{diff_percentage(stock.revenue_hist,i) < -10 ? 'red': '' }}">{{diff_percentage(stock.revenue_hist,i)}}%</span>

            </li>
        </ul>
       <!--<b>revenue growth hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let revenue_item of stock.revenue_growth_arr" >
                <b>{{mult100(revenue_item,0)}}</b>
            </li>
        </ul>-->
       <b>revenue acc avg: <span style="color:orange;">{{stock.revenue_acceleration}}</span></b><br />
       <b>revenue 5y: <span style="color:orange;">{{stock.avg_revenue_growth_5y}}</span></b><br />
       <b>revenue qq: <span style="color:orange;">{{stock.revenue_growth_qq_last_year}}</span></b><br />
       <b>revenue qq hist</b>
       <ul class="list">
            <li class="item" *ngFor="let revenue_item of stock.revenue_growth_qq_last_year_hist" >
             {{revenue_item[0]}}: <b>{{revenue_item[1]}}</b>
            </li>
        </ul>

       <b>op inc hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let revenue_item of stock.operating_income_hist" >
             {{revenue_item[0]}}: <b>{{revenue_item[1]}}</b>
            </li>
        </ul>


       <b>net inc hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let revenue_item of stock.net_income_hist" >
             {{revenue_item[0]}}: <b>{{revenue_item[1]}}</b>
            </li>
        </ul>
       <b>OP: <span style="color:orange;">{{stock.operating_margin}}</span></b>
       <b>OP last diff:       
       <span style="color:green;" *ngIf="(stock.operating_margin_hist_last_diff>=0)">{{stock.operating_margin_hist_last_diff}}%</span>
       <span style="color:red;"   *ngIf="(stock.operating_margin_hist_last_diff<0)">{{stock.operating_margin_hist_last_diff}}%</span>
        </b>. 
       <b>OP hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let item of stock.operating_margin_hist" >
             {{item[0]}}: <b>{{item[1]}}</b>
            </li>
        </ul>
    </ion-col>
    <ion-col>
       <b>EQ hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let item of stock.equity_hist" >
             {{item[0]}}: <b>{{item[1]}}</b> 
            </li>
        </ul>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col>
        <b>PS: <span style="color:orange;">{{stock.price_to_sales}}</span></b>
       <b>PS last diff: 
      <span style="color:red;" *ngIf="(stock.price_to_sales_hist_last_diff>=0)">{{stock.price_to_sales_hist_last_diff}}%</span>
      <span style="color:green;"   *ngIf="(stock.price_to_sales_hist_last_diff<0)">{{stock.price_to_sales_hist_last_diff}}%</span>
        </b>. 
       <b>PS hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let item of stock.price_to_sales_hist" >
             {{item[0]}}: <b>{{item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>


  <ion-row>
  </ion-row>  
  <ion-row>
    <ion-col>
       <b>leverage  <span style="color:brown;">{{stock.leverage}}</span> industry: {{stock.leverage_industry}} lev-inds-ratio: {{leverage_industry_ratio}} <!--avg: <span style="color:pink;">{{stock.avgleverage}}</span>--></b>
       <b>leverage hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let lev_item of stock.leverage_hist" >
             {{lev_item[0]}}: <b>{{lev_item[1]}}</b>
            </li>
        </ul>
    </ion-col>
  </ion-row>
  <ion-row>
  </ion-row>
  <ion-row>
    <ion-col>
       <b>price to book <span style="color:brown;">{{stock.price_to_book}}</span></b>
       <b>price_to_book hist:</b>
       <ul class="list">
            <li class="item" *ngFor="let price_to_book_item of stock.price_to_book_hist" >
             {{price_to_book_item[0]}}: <b>{{price_to_book_item[1]}}</b>
            </li>
        </ul>
    <br /> - Volat: {{ addx(stock.range_52week_volatility,1,1) }}x 
    <br /><br />
   <b>h_souce hist:</b>
   <ul class="list">
        <li class="item" *ngFor="let h_item of stock.h_souce_hist" >
         {{h_item[0]}}: <b>{{h_item[1]}}</b>
        </li>
    </ul>

    <br />
    </ion-col>
  </ion-row>
  
  
  
  

  </ion-grid>
  


</ion-content>
