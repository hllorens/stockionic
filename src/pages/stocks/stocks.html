<ion-header>

  <ion-navbar>
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <span *ngIf="stocks" style="color:black;font-size:0.7em;">{{last_updated}}</span>
          <!--<button ion-button small clear (click)="reorder_asc($event,'name')">
          <span style="color:black;font-size:0.8em;" class="{{orderByField.substring(1) != 'name' ? '': 'ordbsel'}}">n</span>
          </button>-->
          <!--<button ion-button small clear (click)="reorder_desc($event,'avgyield_per_ratio +range_52week_heat')">
            <span style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1).split(' ')[0] != 'avgyield_per_ratio' ? '': 'ordbsel'}}">ypr</span>
          </button>-->
          <button ion-button small clear (click)="reorder_ypr_hec($event)"> 
            <!--<span [hidden]="orderByField.substring(1).split(' ')[0]=='h_souce' || orderByField.substring(1).split(' ')[0]=='operating_margin' || orderByField.substring(1).split(' ')[0]=='price_to_sales' || orderByField.substring(1).split(' ')[0]=='leverage_industry_ratio' || orderByField.substring(1).split(' ')[0]=='mktcap'  || orderByField.substring(1).split(' ')[0]=='inst_own' || orderByField.substring(1).split(' ')[0]=='avg_revenue_growth_5y'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'avgyield_per_ratio' ? '': 'ordbsel'}}">ypr</span>--> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]=='value_hist_last_diff' || orderByField.substring(1).split(' ')[0]=='computable_val_growth' || orderByField.substring(1).split(' ')[0]=='om_to_ps' || orderByField.substring(1).split(' ')[0]=='leverage_industry_ratio' || orderByField.substring(1).split(' ')[0]=='mktcap'  || orderByField.substring(1).split(' ')[0]=='avg_revenue_growth_5y'  || orderByField.substring(1).split(' ')[0]=='guessed_percentage'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'h_souce' ? '': 'ordbsel'}}">hs</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='value_hist_last_diff'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'value_hist_last_diff' ? '': 'ordbsel'}}">vldf</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='computable_val_growth'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'computable_val_growth' ? '': 'ordbsel'}}">vlG</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='guessed_percentage'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'guessed_percentage' ? '': 'ordbsel'}}">gesp</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='om_to_ps'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'om_to_ps' ? '': 'ordbsel'}}">om/ps</span> 
            <!--<span [hidden]="orderByField.substring(1).split(' ')[0]!='price_to_sales'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'price_to_sales' ? '': 'ordbsel'}}">ps</span> -->
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='leverage_industry_ratio'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'leverage_industry_ratio' ? '': 'ordbsel'}}">lev</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='mktcap'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'mktcap' ? '': 'ordbsel'}}">mktc</span> 
            <!--<span [hidden]="orderByField.substring(1).split(' ')[0]!='inst_own'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'inst_own' ? '': 'ordbsel'}}">inst</span> -->
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='avg_revenue_growth_5y'" style="color:purple;font-size:0.8em;" class="{{orderByField.substring(1) != 'avg_revenue_growth_5y' ? '': 'ordbsel'}}">rG</span> 
          </button>
          <button ion-button small clear (click)="reorder_per_eps($event)"> <!-- reorder_asc($event,'per, now epsp') -->
            <span [hidden]="orderByField.substring(1).split(' ')[0]=='prod'" style="color:orange;font-size:0.8em;" class="{{orderByField.substring(1) != 'epsp' ? '': 'ordbsel'}}">epsp</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0]!='prod'" style="color:orange;font-size:0.8em;" class="{{orderByField.substring(1) != 'prod' ? '': 'ordbsel'}}">prod</span>
            <!--<span [hidden]="orderByField.substring(1).split(' ')[0]!='eps_hist_last_diff'" style="color:orange;font-size:0.8em;" class="{{orderByField.substring(1) != 'eps_hist_last_diff' ? '': 'ordbsel'}}">epspd</span> -->
          </button>
          <button ion-button small clear (click)="reorder_desc($event,'avgyield')">
            <span style="color:green;font-size:0.8em;" class="{{orderByField.substring(1) != 'avgyield' ? '': 'ordbsel'}}">yld</span>
          </button>
          <button ion-button small clear (click)="reorder_52_heat_vol($event)"> <!-- originally reorder($event,'range_52week_heat +yield')-->
            <span style="font-size:0.8em;" class="{{orderByField.substring(1) != 'range_52week_heat +yield' ? '': 'ordbsel'}}">52w</span> 
            <span [hidden]="orderByField.substring(1).split(' ')[0] != 'range_52week_heat'"><span [hidden]="reverseSort=='+'">^</span><span [hidden]="reverseSort=='-'">v</span></span>
            <span [hidden]="orderByField.substring(1).split(' ')[0] != 'range_52week_volatility'">vo</span>
          </button>
          <button ion-button small clear (click)="showAlerted()">
            <span style="color:black;font-size:0.8em;" class="{{alert_filter_on ? 'alerted': ''}}"><ion-icon name="notifications"></ion-icon></span>
          </button>
  </ion-navbar>
</ion-header>


<ion-content padding>

    <ion-searchbar (ionInput)="getItems($event)"></ion-searchbar>

  <ion-list>
    <button ion-item *ngFor="let stock of stocks | orderBy : [ orderByField ]; let i=index; "  (click)="itemTapped($event, stock,alerts[stock.name+':'+stock.market], usdeur)">
    <ion-grid>
        <ion-row class="{{alerts[stock.name+':'+stock.market]?.active==true ? 'alerted': ''}}">
            <ion-col width-33>
              <span style="color:purple;font-size:0.7em;">{{cognitionis.addx(i,1,0)}}</span> {{ stock.name }}
              <span *ngIf="stock.h_souce>=5" style="color:purple;font-size:0.8em;">{{stock.h_souce}}</span><span *ngIf="stock.h_souce<5" style="color:red;font-size:0.8em;">{{stock.h_souce}}</span> <!--:{{stock.market[0]}}-->
              <span style="color:red;font-size:0.8em;" *ngIf="outdated(stock)">o</span>

              <p style="width:50%;"><progress-bar [progress]="cognitionis.mult100(stock.range_52week_heat)"></progress-bar> <span style="color:blue;font-size:0.7em;">{{ cognitionis.addx(stock.range_52week_volatility,1,1) }}x</span></p>
            </ion-col>
            <ion-col width-25>
              <span style="color:blue;font-size:0.9em;" *ngIf="cognitionis.usd_market(stock.market)">$</span>
              <span style="color:blue;font-size:0.9em;">{{ cognitionis.redux_format(stock.value) }}</span>
              <span style="color:green;font-size:0.7em;" *ngIf="cheap(stock.value,stock.guessed_value_5y) && !cognitionis.isIndexStock(stock.market)">{{mkt_guess_ratio(stock.value,stock.guessed_value_5y)}}</span>
              <span style="color:red;font-size:0.7em;" *ngIf="expensive(stock.value,stock.guessed_value_5y) && !cognitionis.isIndexStock(stock.market)">{{mkt_guess_ratio(stock.value,stock.guessed_value_5y)}}</span>
              <br />
              <span style="text-align=right;font-size:0.8em;">{{ cognitionis.redux_format_max(stock.range_52week_low) }}-{{ cognitionis.redux_format_max(stock.range_52week_high) }}</span>
            </ion-col>
            <ion-col width-25>
                <span *ngIf="stock.avgyield>=1 && stock.avgyield<1.9" style="color:green;font-size:0.8em;">{{ stock.avgyield }}<span *ngIf="stock.avgyield>0 && stock.avgyield>cognitionis.mult100float(stock.epsp)" style="color:red;font-size:0.8em;">*</span></span> 
                <span *ngIf="stock.avgyield>=1.9" style="color:green;font-size:0.8em;font-weight:bold;">{{ stock.avgyield }}<span *ngIf="stock.avgyield>0 && stock.avgyield>cognitionis.mult100float(stock.epsp)" style="color:red;font-size:0.8em;">*</span></span>                <!--<br />-->

                <span style="color:orange;font-size:0.8em;font-weight:bold;" *ngIf="stock.prod>=0 && stock.prod>=0.05">{{cognitionis.mult100_fix2(stock.prod)}}</span>
                <span style="color:orange;font-size:0.8em;" *ngIf="stock.prod>=0 && stock.prod<0.05 && !cognitionis.isIndexStock(stock.market)">{{cognitionis.mult100_fix2(stock.prod)}}</span>
                <span style="color:red;font-size:0.8em;" *ngIf="stock.prod<0">{{cognitionis.mult100_fix2(stock.prod)}}</span>
                <span style="font-size:0.8em;" *ngIf="stock.prod_ps_trend"> 
                            <span style="color:red;" *ngIf="(stock.prod_ps_trend!='/' && stock.prod_ps_trend!='/-' && stock.prod_ps_trend!='_/' && stock.prod_ps_trend!='--' && stock.prod_ps_trend!='v')">{{stock.prod_ps_trend}}</span>
                            <span style="color:green;" *ngIf="(stock.prod_ps_trend=='/' || stock.prod_ps_trend=='/-' || stock.prod_ps_trend=='_/' || stock.prod_ps_trend=='--' || stock.prod_ps_trend=='v') ">{{stock.prod_ps_trend}}</span>
                </span>
                <br />
                <span style="font-size:0.8em;" *ngIf="(stock.revenue_growth>0.02 || stock.revenue_growth<-0.01)" class="{{stock.revenue_growth >0.25 ? 'blue': ''}} {{stock.revenue_growth < 0 ? 'red': '' }}">g{{cognitionis.mult100(cognitionis.min(stock.revenue_growth,1,2))}}</span><span style="font-size:0.8em;" *ngIf="(stock.revenue_growth>0.02 || stock.revenue_growth<-0.01) && stock.revenue_growth_trend && stock.revenue_growth_trend!='--'"><span style="color:red;" *ngIf="(stock.revenue_growth_trend!='/' && stock.revenue_growth_trend!='/-' && stock.revenue_growth_trend!='_/' && stock.revenue_growth_trend!='--' && stock.revenue_growth_trend!='v')">{{stock.revenue_growth_trend}}</span><span style="color:green;" *ngIf="(stock.revenue_growth_trend=='/' || stock.revenue_growth_trend=='/-' || stock.revenue_growth_trend=='_/' || stock.revenue_growth_trend=='--' || stock.revenue_growth_trend=='v') ">{{stock.revenue_growth_trend}}</span><span style="color:green;font-size=0.6em;" *ngIf="(stock.revenue_growth_trend=='/' && stock.revenue_acceleration>0)">a</span></span>
                <span style="font-size:0.8em;color:red;" *ngIf="stock.leverage_industry_ratio>=1.8 && !cognitionis.isIndexStock(stock.market)" >l{{cognitionis.max(stock.leverage_industry_ratio,1,1)}}</span>
                <span style="font-size:0.8em;color:red;" *ngIf="stock.current_ratio<0.9 && !cognitionis.isIndexStock(stock.market)" >cr{{cognitionis.toFixed2(stock.current_ratio)}}</span>
				<span style="font-size:0.8em;color:red;" *ngIf="stock.price_to_book>6">pb</span>
            </ion-col>
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]=='value_hist_last_diff' || orderByField.substring(1).split(' ')[0]=='computable_val_growth' || orderByField.substring(1).split(' ')[0]=='om_to_ps' || orderByField.substring(1).split(' ')[0]=='leverage_industry_ratio' || orderByField.substring(1).split(' ')[0]=='mktcap' || orderByField.substring(1).split(' ')[0]=='inst_own' || orderByField.substring(1).split(' ')[0]=='avg_revenue_growth_5y' || orderByField.substring(1).split(' ')[0]=='prod' || orderByField.substring(1).split(' ')[0]=='epsp' || orderByField.substring(1).split(' ')[0]=='guessed_percentage'">
                    <span style="font-size:0.7em;"><ion-icon name="notifications" *ngIf="alerts[stock.name+':'+stock.market]"></ion-icon></span>
                    <span *ngIf="alerts[stock.name+':'+stock.market] && alerts[stock.name+':'+stock.market].portf && portfdiff(alerts[stock.name+':'+stock.market].portf,stock.market,stock.value)>=0" style="color:green;font-size:0.7em;">{{cognitionis.mult100(portfdiff(alerts[stock.name+':'+stock.market].portf,stock.market,stock.value))}}%</span>
                    <span *ngIf="alerts[stock.name+':'+stock.market] && alerts[stock.name+':'+stock.market].portf && portfdiff(alerts[stock.name+':'+stock.market].portf,stock.market,stock.value)<0" style="color:red;font-size:0.7em;">{{cognitionis.mult100(portfdiff(alerts[stock.name+':'+stock.market].portf,stock.market,stock.value))}}%</span>
                    <br />
                    <span *ngIf="stock.computable_val_growth>=0" style="color:green;font-size:0.7em;">{{cognitionis.mult100(stock.computable_val_growth)}}%</span>
                    <span *ngIf="stock.computable_val_growth<0" style="color:red;font-size:0.7em;">{{cognitionis.mult100(stock.computable_val_growth)}}%</span>
                    
            </ion-col>
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='value_hist_last_diff' && orderByField.substring(1).split(' ')[0]!='computable_val_growth'">
                    
                    <p style="color:green;font-size:0.7em;" *ngIf="(stock.computable_val_growth>=0)">{{cognitionis.mult100(stock.computable_val_growth)}}%</p>
                    <p style="color:red;font-size:0.7em;"   *ngIf="(stock.computable_val_growth<0)">{{cognitionis.mult100(stock.computable_val_growth)}}%</p>
                    <p style="color:green;font-size:0.7em;" *ngIf="(stock.value_hist_last_diff>=0)">1y:{{stock.value_hist_last_diff}}%</p>
                    <p style="color:red;font-size:0.7em;"   *ngIf="(stock.value_hist_last_diff<0)">1y:{{stock.value_hist_last_diff}}%</p>
                    <p style="color:green;font-size:0.7em;" *ngIf="(stock.val_change_3y>=0)">3y:{{stock.val_change_3y}}%</p>
                    <p style="color:red;font-size:0.7em;"   *ngIf="(val_change_3y)">3y:{{stock.val_change_3y}}%</p>
                    <p style="color:green;font-size:0.7em;" *ngIf="(stock.val_change_5y>=0)">5y:{{stock.val_change_5y}}%</p>
                    <p style="color:red;font-size:0.7em;"   *ngIf="(stock.val_change_5y<0)">5y:{{stock.val_change_5y}}%</p>
            </ion-col>
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='guessed_percentage'">
                    <p style="font-size:0.7em;"><span class="{{stock.guessed_percentage<0.9 ? 'green' : '' }} {{stock.guessed_percentage>1.7 ? 'red' : '' }}">{{cognitionis.mult100(stock.guessed_percentage)}}%</span><br />
					                                        5y:{{stock.guessed_value_5y}}<br />
															X:{{stock.guessed_value}}</p>
            </ion-col>
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='om_to_ps'">
                    <p style="color:green;font-size:0.7em;">{{stock.om_to_ps}}<br />om:{{stock.avgoperating_margin}}({{stock.operating_margin_prev}})<br />ps:{{stock.avgprice_to_sales}}</p>
            </ion-col>
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='prod' && orderByField.substring(1).split(' ')[0]!='epsp'">
                    <p style="color:green;font-size:0.7em;">epsp:{{cognitionis.mult100(stock.epsp)}}<br />om:{{stock.operating_margin}}</p>
            </ion-col>
            <!--<ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='price_to_sales'">
                    <p style="color:orange;font-size:0.7em;">{{ stock.price_to_sales }}</p>
            </ion-col>-->
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='leverage_industry_ratio'">
                    <p style="color:red;font-size:0.7em;">{{ stock.leverage }}/{{stock.leverage_industry}}<br />={{stock.leverage_industry_ratio}}<br />cr{{stock.current_ratio}}</p>
            </ion-col>
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='mktcap'">
                    <p style="color:blue;font-size:0.7em;">{{ stock.mktcap }}<br />sh:{{stock.shares}}</p>
            </ion-col>
            <!--<ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='inst_own'">
                    <p style="color:blue;color:font-size:0.7em;">{{ stock.inst_own }}</p>
            </ion-col>-->
            <ion-col width-25 [hidden]="orderByField.substring(1).split(' ')[0]!='avg_revenue_growth_5y'">
                    <p style="color:blue;font-size:0.7em;">{{stock.avg_revenue_growth_5y}}</p>
                    <p style="color:blue;font-size:0.7em;">qq:{{stock.revenue_growth_qq_last_year}}</p>
            </ion-col>
        </ion-row>
    </ion-grid>
    </button>
  </ion-list>
</ion-content>
